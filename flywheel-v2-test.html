<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>The Pigeon Way - Flywheel V2 (Test)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,600;0,700;1,600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; overflow-x: hidden; }
        .serif { font-family: 'Playfair Display', serif; }
        
        .socle-bg {
            background-color: #0f172a;
            background-image: linear-gradient(rgba(30, 41, 59, 0.5) 1px, transparent 1px),
            linear-gradient(90deg, rgba(30, 41, 59, 0.5) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    </style>
</head>

<body class="bg-slate-100 min-h-screen">
    <!-- Navigation Header (will be inserted by navigation.js) -->
    <div id="navigation-container" class="max-w-[1400px] mx-auto px-4 pt-4"></div>

    <!-- React App Root -->
    <div id="root" class="w-full max-w-[1400px] mx-auto px-4 pb-8"></div>

    <!-- Footer -->
    <div class="mt-12 text-center text-slate-400 text-xs border-t border-slate-200 pt-4 max-w-[1400px] mx-auto px-4">
        Generated by Inocta.io MIO Engine for Pigeon â€¢ Confidential
    </div>

    <!-- Load authentication and utilities -->
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/highlight-text.js"></script>
    <script src="js/ops-sheet-v2-mapper.js"></script>
    
    <!-- Initialize navigation and authentication -->
    <script>
        // Check authentication before loading page
        if (typeof requireAuth === 'function') {
            requireAuth('welcome.html');
        } else {
            // Wait for auth.js to load
            window.addEventListener('load', function() {
                if (typeof requireAuth === 'function') {
                    requireAuth('welcome.html');
                }
            });
        }
        
        // Insert navigation
        document.addEventListener('DOMContentLoaded', function() {
            const navContainer = document.getElementById('navigation-container');
            if (navContainer) {
                navContainer.innerHTML = createNavigation('flywheel-v2-test');
            }
        });
    </script>

    <!-- React App -->
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { motion, AnimatePresence } = window.Motion;

        // Process Badge Component
        const ProcessBadge = ({ status, color }) => {
            // Map status to display text (matching v1)
            const statusText = {
                'NEW': 'NEW',
                'ACTIVE': 'Active',
                'TODO': 'To implement',
                'MERGE': 'Merge'
            };
            const displayText = statusText[status] || status;
            
            // Map status to background color (Active should always be green like "OK")
            const bgColor = status === 'NEW' ? '#4f46e5' : 
                           status === 'ACTIVE' ? '#16a34a' : // green-600 - always green for Active
                           status === 'TODO' ? '#f59e0b' : 
                           status === 'MERGE' ? '#dc2626' : 
                           color;
            
            return (
                <span className={`text-[9px] font-bold px-1.5 py-0.5 rounded text-white`} 
                      style={{backgroundColor: bgColor}}>
                    {displayText}
                </span>
            );
        };

        // AI Data Component (Accordion - Closed by Default)
        const AIDataSection = ({ aiData, stageColor }) => {
            const [isOpen, setIsOpen] = useState(false);
            
            return (
                <motion.div 
                    initial={{opacity: 0, scale: 0.95}} 
                    animate={{opacity: 1, scale: 1}} 
                    transition={{delay: 0.2}}
                    className="mx-6 mt-4 rounded-lg border border-l-4 overflow-hidden"
                    style={{backgroundColor: `${stageColor}10`, borderColor: stageColor}}
                >
                    {/* Accordion Header - Clickable */}
                    <button
                        onClick={() => setIsOpen(!isOpen)}
                        className="w-full p-4 flex items-center justify-between hover:bg-opacity-20 transition-colors"
                        style={{backgroundColor: isOpen ? `${stageColor}15` : 'transparent'}}
                    >
                        <span className="text-[10px] font-bold uppercase tracking-widest flex items-center gap-2" style={{color: stageColor}}>
                            <svg className="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z" />
                            </svg>
                            Documentation & AI Potential
                        </span>
                        <motion.svg
                            className="w-4 h-4"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            style={{color: stageColor}}
                            animate={{ rotate: isOpen ? 180 : 0 }}
                            transition={{ duration: 0.3 }}
                        >
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                        </motion.svg>
                    </button>
                    
                    {/* Accordion Content - Animated */}
                    <AnimatePresence>
                        {isOpen && (
                            <motion.div
                                initial={{ height: 0, opacity: 0 }}
                                animate={{ height: 'auto', opacity: 1 }}
                                exit={{ height: 0, opacity: 0 }}
                                transition={{ duration: 0.3, ease: 'easeInOut' }}
                                className="overflow-hidden"
                            >
                                <div className="px-4 pb-4 space-y-3">
                                    <div>
                                        <div className="text-[9px] font-bold text-slate-400 uppercase">The Rule</div>
                                        <div className="text-xs font-medium text-slate-800 italic">"{aiData.rule}"</div>
                                    </div>
                                    
                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        <div>
                                            <div className="text-[9px] font-bold text-slate-400 uppercase mb-1">What to Document</div>
                                            <ul className="list-disc list-inside">
                                                {aiData.docs.map((doc, idx) => (
                                                    <li key={idx} className="text-[10px] text-slate-600">{doc}</li>
                                                ))}
                                            </ul>
                                        </div>
                                        <div>
                                            <div className="text-[9px] font-bold text-slate-400 uppercase mb-1">AI Implication</div>
                                            <div className="text-[10px] text-slate-600 leading-relaxed">{aiData.implication}</div>
                                        </div>
                                    </div>
                                </div>
                            </motion.div>
                        )}
                    </AnimatePresence>
                </motion.div>
            );
        };

        // Support Engine Footer Component (6 Pillars)
        const SupportEngineFooter = ({ activePillars = [], gatewayActions = {} }) => {
            // Helper to render text with bold markers **text**
            const renderItemText = (text) => {
                const parts = text.split(/(\*\*.*?\*\*)/);
                return parts.map((part, index) => {
                    if (part.startsWith('**') && part.endsWith('**')) {
                        return React.createElement('strong', { key: index, className: 'text-white font-bold' }, part.slice(2, -2));
                    }
                    return part;
                });
            };

            // Support Engine data with 6 pillars
            const columns = [
                {
                    id: 'account_mgmt',
                    title: 'Account Management',
                    color: '#06b6d4', // cyan-500
                    percentage: 50,
                    gatewayAction: 'Client touch point and coordination',
                    items: [
                        'Client Relationships',
                        '**New Client Onboarding**',
                        'Quarterly Business Reviews',
                        'Renewals & Upselling',
                        'Project Handoffs',
                        'Issue Escalation'
                    ]
                },
                {
                    id: 'finance',
                    title: 'Finance and Admin',
                    color: '#a0c928', // Matching DEFINE stage green
                    percentage: 60,
                    gatewayAction: 'Financial Health: Stability & Profitability',
                    items: [
                        'Forecasting & **Budgeting (*)**',
                        'Reporting & Quarterly Reviews',
                        'Payroll & Cashflow',
                        'Billing & Contracts',
                        'Client Onboarding'
                    ]
                },
                {
                    id: 'hr',
                    title: 'HR (People)',
                    color: '#D6407D', // Matching DISCOVER stage pink
                    percentage: 65,
                    gatewayAction: 'Employee Lifecycle: Recruitment to Retention',
                    items: [
                        '**Onboarding (*)** & Offboarding',
                        'Recruiting & Promotion',
                        'Performance Management',
                        'Training & Development',
                        'Employee Engagement'
                    ]
                },
                {
                    id: 'it',
                    title: 'IT',
                    color: '#E98C38', // Matching DEVELOP stage orange
                    percentage: 50,
                    gatewayAction: 'Infrastructure: Assets, Support & Security',
                    items: [
                        '**Font Purchasing** (*)',
                        'Troubleshooting & Support',
                        'High-level Tech Projects',
                        'Staff Training',
                        'Freelancer/Intern Setup',
                        'Security and Infrastructure'
                    ]
                },
                {
                    id: 'marketing',
                    title: 'Marketing',
                    color: '#6366f1', // indigo-500
                    percentage: 35,
                    gatewayAction: 'Events Management, GEO...',
                    items: [
                        'PR & Blog',
                        'Newsletters',
                        'Events Management',
                        'Website Maintenance',
                        'Templates & Assets'
                    ]
                },
                {
                    id: 'ceo',
                    title: 'CEO Office',
                    color: '#f59e0b', // amber-500
                    percentage: undefined, // No percentage for CEO
                    gatewayAction: 'Vision & Alignment: Strategy to Execution',
                    items: [
                        'Board Relations',
                        'Investor Reporting',
                        'Strategic Initiatives',
                        'Internal Communications',
                        'Executive Support'
                    ]
                }
            ];

            const isPillarActive = (pillarId) => {
                return activePillars.includes(pillarId);
            };

            const getGatewayAction = (pillarId) => {
                // Use hardcoded columns first, then fall back to gatewayActions from stage data
                const column = columns.find(c => c.id === pillarId);
                return column?.gatewayAction || gatewayActions[pillarId] || '';
            };

            return (
                <div className="w-full bg-[#0B0F19] text-slate-300 rounded-xl shadow-2xl border border-slate-800 overflow-hidden relative">
                    {/* Background Grid Pattern */}
                    <div className="absolute inset-0 opacity-10 pointer-events-none" 
                         style={{
                             backgroundImage: `linear-gradient(#2d3748 1px, transparent 1px), linear-gradient(90deg, #2d3748 1px, transparent 1px)`,
                             backgroundSize: '40px 40px'
                         }}>
                    </div>

                    {/* Columns Wrapper - 6 columns */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 relative z-10 divide-y md:divide-y-0 md:divide-x divide-slate-800/50">
                        {columns.map((col) => {
                            const active = isPillarActive(col.id);
                            const gatewayText = getGatewayAction(col.id);
                            
                            return (
                                <div key={col.id} className={`group relative p-4 md:p-6 transition-all duration-300 hover:bg-slate-800/30 flex flex-col h-full ${active ? 'bg-slate-800/50' : ''}`}>
                                    
                                    {/* Column Header - Fixed height for alignment */}
                                    <div className="flex items-start gap-3 mb-4 md:mb-6 min-h-[3.5rem]">
                                        <div className={`w-2.5 h-2.5 rounded-full shadow-[0_0_8px_rgba(255,255,255,0.3)] mt-0.5 shrink-0`} style={{backgroundColor: col.color}}></div>
                                        <h3 className="font-bold text-slate-100 text-sm md:text-lg tracking-wide leading-tight">{col.title}</h3>
                                    </div>

                                    {/* Gateway Action Box - Always Visible - Fixed height for alignment */}
                                    <div className={`mb-4 md:mb-6 p-3 md:p-4 rounded-lg border bg-slate-900/50 backdrop-blur-sm relative overflow-hidden transition-all duration-300 h-[6.5rem] flex flex-col ${active ? 'border-opacity-50' : 'border-opacity-30'}`} style={{borderColor: col.color}}>
                                        {/* Accent glow inside box */}
                                        <div className="absolute top-0 left-0 w-1 h-full" style={{backgroundColor: col.color}}></div>
                                        
                                        <p className={`text-[9px] md:text-[10px] uppercase font-bold tracking-widest mb-2 opacity-80 shrink-0`} style={{color: col.color}}>
                                            Gateway Action
                                        </p>
                                        <p className="text-[10px] md:text-sm font-semibold text-white leading-tight flex-grow" style={{lineHeight: '1.3'}}>
                                            {gatewayText}
                                        </p>
                                    </div>

                                    {/* Process Documentation Progress Bar with Tooltip - Fixed height for alignment */}
                                    {col.percentage !== undefined ? (
                                        <div className="mb-4 md:mb-6 relative group/tooltip h-[2.5rem]">
                                            <div className="flex justify-between items-center mb-1 cursor-help">
                                                <p className="text-[9px] md:text-[10px] uppercase font-bold tracking-widest text-slate-500 border-b border-dashed border-slate-700 group-hover/tooltip:border-slate-400 transition-colors">
                                                    Documentation Standard
                                                </p>
                                                <p className="text-[10px] md:text-xs font-bold text-slate-300">
                                                    {col.percentage}%
                                                </p>
                                            </div>
                                            
                                            {/* Tooltip Content */}
                                            <div className="absolute bottom-full left-0 mb-2 w-48 p-2 bg-slate-800 border border-slate-700 text-slate-300 text-[10px] rounded shadow-xl opacity-0 group-hover/tooltip:opacity-100 transition-opacity duration-200 pointer-events-none z-20">
                                                The required % of documented tasks in that process
                                                {/* Tooltip Arrow */}
                                                <div className="absolute top-full left-4 -mt-[1px] border-4 border-transparent border-t-slate-700"></div>
                                            </div>

                                            <div className="w-full h-1.5 bg-slate-800/50 rounded-full overflow-hidden">
                                                <div 
                                                    className="h-full transition-all duration-500 ease-in-out"
                                                    style={{ width: `${col.percentage}%`, backgroundColor: col.color }}
                                                ></div>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="mb-4 md:mb-6 h-[2.5rem]"></div>
                                    )}

                                    {/* List Items - Aligned at top */}
                                    <ul className="space-y-2 md:space-y-3">
                                        {col.items.map((item, index) => (
                                            <li key={index} className="flex items-start gap-2 md:gap-3 text-[10px] md:text-sm text-slate-400 group-hover:text-slate-300 transition-colors">
                                                <div className="w-[1px] h-4 bg-slate-700 mt-1 shrink-0"></div>
                                                <span className="leading-snug">{renderItemText(item)}</span>
                                            </li>
                                        ))}
                                    </ul>

                                    {/* Hover Effect Border Bottom */}
                                    <div className={`absolute bottom-0 left-0 w-full h-[2px] transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-left`} style={{backgroundColor: col.color}}></div>
                                </div>
                            );
                        })}
                    </div>

                </div>
            );
        };

        // PillarWheel Component - Adapted from flywheel-v2b.html
        const PillarWheel = ({ stages, activeId, setActiveId }) => {
            const radius = 160;
            const center = 250;
            
            if (!stages || stages.length === 0) {
                return <div className="text-slate-400">Loading wheel...</div>;
            }
            
            return (
                <div className="relative w-[500px] h-[600px] flex items-center justify-center -mt-10">
                    <svg viewBox="0 0 500 600" className="w-full h-full">
                        <defs>
                            <filter id="softShadow" x="-20%" y="-20%" width="140%" height="140%">
                                <feGaussianBlur in="SourceAlpha" stdDeviation="5"/>
                                <feOffset dx="0" dy="5" result="offsetblur"/>
                                <feComponentTransfer>
                                    <feFuncA type="linear" slope="0.3"/>
                                </feComponentTransfer>
                                <feMerge> 
                                    <feMergeNode/>
                                    <feMergeNode in="SourceGraphic"/> 
                                </feMerge>
                            </filter>
                        </defs>
                        <path d="M 230 250 L 270 250 L 270 520 L 230 520 Z" fill="#1e293b" />
                        <path d="M 150 520 L 350 520 L 370 580 L 130 580 Z" fill="#0f172a" />
                        <text x="250" y="560" textAnchor="middle" fill="#64748b" className="text-[10px] font-bold tracking-[0.2em] uppercase">The Support Engine</text>
                        <circle cx="190" cy="540" r="3" fill="#cbd5e1" />
                        <circle cx="230" cy="540" r="3" fill="#cbd5e1" />
                        <circle cx="270" cy="540" r="3" fill="#cbd5e1" />
                        <circle cx="310" cy="540" r="3" fill="#cbd5e1" />

                        <g filter="url(#softShadow)">
                            {stages.map((stage, index) => {
                                const totalStages = stages.length;
                                const anglePerStage = 360 / totalStages;
                                const startAngle = (index * anglePerStage) - 90;
                                const endAngle = ((index + 1) * anglePerStage) - 90;
                                const isActive = activeId === stage.id;
                                const x1 = center + radius * Math.cos(Math.PI * (startAngle) / 180);
                                const y1 = center + radius * Math.sin(Math.PI * (startAngle) / 180);
                                const x2 = center + radius * Math.cos(Math.PI * (endAngle) / 180);
                                const y2 = center + radius * Math.sin(Math.PI * (endAngle) / 180);
                                const innerRadius = 90;
                                const ix1 = center + innerRadius * Math.cos(Math.PI * (endAngle) / 180);
                                const iy1 = center + innerRadius * Math.sin(Math.PI * (endAngle) / 180);
                                const ix2 = center + innerRadius * Math.cos(Math.PI * (startAngle) / 180);
                                const iy2 = center + innerRadius * Math.sin(Math.PI * (startAngle) / 180);
                                const pathData = `M ${x1} ${y1} A ${radius} ${radius} 0 0 1 ${x2} ${y2} L ${ix1} ${iy1} A ${innerRadius} ${innerRadius} 0 0 0 ${ix2} ${iy2} Z`;
                                const midAngle = startAngle + (anglePerStage / 2);
                                const labelR = (radius + innerRadius) / 2;
                                const tx = center + labelR * Math.cos(Math.PI * midAngle / 180);
                                const ty = center + labelR * Math.sin(Math.PI * midAngle / 180);

                                return (
                                    <g key={stage.id} onClick={() => setActiveId(stage.id)} className="cursor-pointer group">
                                        <path 
                                            d={pathData} 
                                            fill={stage.color}
                                            stroke="white"
                                            strokeWidth="4"
                                            className="transition-all duration-300"
                                            style={{
                                                opacity: isActive ? 1 : 0.8, 
                                                transformOrigin: 'center', 
                                                transform: isActive ? 'scale(1.05)' : 'scale(1)'
                                            }}
                                        />
                                        <text x={tx} y={ty} textAnchor="middle" dominantBaseline="middle" fill="white" className="text-2xl font-bold font-serif opacity-90 pointer-events-none">{stage.id}</text>
                                    </g>
                                )
                            })}
                        </g>
                        <circle cx={center} cy={center} r="75" fill="white" filter="url(#softShadow)" />
                        <circle cx={center} cy={center} r="70" fill="white" stroke="#e2e8f0" strokeWidth="1" />
                        <foreignObject x={center - 50} y={center - 50} width="100" height="100">
                            <div className="w-full h-full flex flex-col items-center justify-center text-center pointer-events-none">
                                <span className="text-[10px] font-bold tracking-widest text-slate-400 uppercase">Truth.</span>
                                <span className="text-2xl font-bold text-slate-900 serif leading-tight">Client</span>
                                <span className="text-[9px] font-bold tracking-widest text-slate-400 uppercase">Delivered.</span>
                            </div>
                        </foreignObject>
                    </svg>
                </div>
            )
        }

        // Main App Component
        const App = () => {
            const [stages, setStages] = useState([]);
            const [activeId, setActiveId] = useState(1);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                // Load and transform stages data
                if (typeof loadAndTransformStagesData === 'function') {
                    loadAndTransformStagesData().then(transformedStages => {
                        setStages(transformedStages);
                        setLoading(false);
                        if (transformedStages.length > 0) {
                            setActiveId(transformedStages[0].id);
                        }
                    });
                } else {
                    console.error('loadAndTransformStagesData function not found');
                    setLoading(false);
                }
            }, []);

            if (loading) {
                return (
                    <div className="w-full flex items-center justify-center py-20">
                        <div className="text-slate-400">Loading flywheel...</div>
                    </div>
                );
            }

            if (stages.length === 0) {
                return (
                    <div className="w-full flex items-center justify-center py-20">
                        <div className="text-red-600">Error loading stages data. Please check the console.</div>
                    </div>
                );
            }

            const activeStage = stages.find(s => s.id === activeId);

            return (
                <div className="w-full flex flex-col gap-8">
                    
                    {/* MAIN CONTENT AREA */}
                    <div className="flex flex-col lg:flex-row gap-0 items-center lg:items-start h-auto lg:h-[600px]">
                        
                        {/* LEFT: THE PILLAR WHEEL */}
                        <div className="w-full lg:w-1/3 flex flex-col items-center justify-start pt-10 h-full relative">
                            <div className="absolute top-0 left-0 text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em] mb-4">The Client Cycle ({stages.length} Stages)</div>
                            <PillarWheel stages={stages} activeId={activeId} setActiveId={setActiveId} />
                        </div>

                        {/* RIGHT: THE DETAIL CARD */}
                        <div className="w-full lg:w-2/3 h-full pt-10">
                            <AnimatePresence mode="wait">
                                <motion.div 
                                    key={activeStage.id}
                                    initial={{ opacity: 0, x: 20 }}
                                    animate={{ opacity: 1, x: 0, zIndex: 10 }}
                                    exit={{ opacity: 0, x: -20 }}
                                    transition={{ duration: 0.3 }}
                                    className="bg-white rounded-xl shadow-2xl overflow-hidden border-t-8 flex flex-col pb-6 min-h-[600px] relative z-10"
                                    style={{ borderColor: activeStage.color }}
                                >
                                    {/* Card Header */}
                                    <div className="p-4 md:p-5 pb-3 shrink-0 border-b border-slate-100">
                                        {/* Top Row: Step Number & Engine Badge */}
                                        <div className="flex items-center justify-between mb-3">
                                            <div className="text-[11px] font-bold uppercase tracking-widest" style={{color: activeStage.color}}>
                                                STEP {activeStage.id}
                                            </div>
                                            {activeStage.engine && (
                                                <span className="text-[9px] font-bold uppercase tracking-wider px-2.5 py-1 rounded" style={{backgroundColor: activeStage.color, color: activeStage.textColor}}>
                                                    {activeStage.engine}
                                                </span>
                                            )}
                                        </div>
                                        
                                        {/* Main Content Grid */}
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                                            {/* Left Column: Title, Tagline, Description */}
                                            <div className="md:col-span-2 space-y-3">
                                                <div>
                                                    <h2 className="text-3xl md:text-4xl lg:text-5xl font-bold text-slate-900 mb-2 leading-tight">{activeStage.name}</h2>
                                                    <p className="serif italic text-slate-500 text-base md:text-lg">"{activeStage.tagline}"</p>
                                                </div>
                                                
                                                {/* Description */}
                                                {activeStage.description && (
                                                    <motion.div 
                                                        initial={{opacity: 0, y: -5}} 
                                                        animate={{opacity: 1, y: 0}} 
                                                        transition={{delay: 0.15}}
                                                        className="pl-4 pr-3 py-2.5 bg-slate-50 rounded-r-lg border-l-2"
                                                        style={{borderColor: activeStage.color}}
                                                    >
                                                        <p className="text-sm text-slate-600 leading-relaxed">{activeStage.description}</p>
                                                    </motion.div>
                                                )}
                                            </div>
                                            
                                            {/* Right Column: Metrics Card with KPI */}
                                            <div className="md:col-span-1">
                                                <div className="bg-white border border-slate-200 rounded-lg p-4 shadow-sm h-full flex flex-col justify-center">
                                                    {/* KPI Percentage - Large and Prominent */}
                                                    <div className="text-center mb-3">
                                                        <motion.div 
                                                            initial={{scale: 0.8, opacity: 0}} 
                                                            animate={{scale: 1, opacity: 1}} 
                                                            transition={{duration: 0.5, delay: 0.2}}
                                                            className="text-4xl md:text-5xl font-bold leading-none mb-1"
                                                            style={{color: activeStage.color}}
                                                        >
                                                            {activeStage.health}%
                                                        </motion.div>
                                                    </div>
                                                    
                                                    {/* Label */}
                                                    <div className="text-center mb-3">
                                                        <div className="text-[9px] font-bold text-slate-400 uppercase tracking-wider leading-tight">
                                                            Documentation<br />Standard
                                                        </div>
                                                    </div>
                                                    
                                                    {/* Progress Bar */}
                                                    <div className="w-full h-2 bg-slate-200 rounded-full overflow-hidden">
                                                        <motion.div 
                                                            initial={{width: 0}} 
                                                            animate={{width: `${activeStage.health}%`}} 
                                                            transition={{duration: 0.8, ease: "easeOut", delay: 0.3}}
                                                            className="h-full rounded-full" 
                                                            style={{backgroundColor: activeStage.color}}
                                                        />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Card Body */}
                                    <motion.div 
                                        layout
                                        className="flex-grow overflow-y-auto custom-scroll p-4 md:p-6"
                                    >
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-6">
                                            {/* Our People Section - Compact Design */}
                                            <div className="space-y-3">
                                                <h3 className="text-[10px] font-bold text-slate-400 uppercase flex items-center gap-2">
                                                    <span className="w-2 h-2 rounded-full" style={{backgroundColor: activeStage.color}}></span> Our People
                                                </h3>
                                                
                                                {/* The Experts - Inline Layout */}
                                                <div className="space-y-1.5 pb-3 border-b border-slate-200">
                                                    <div className="text-[9px] font-bold text-slate-400 uppercase tracking-wider">The Experts</div>
                                                    <div className="text-sm font-medium text-slate-700 leading-relaxed">
                                                        <HighlightText text={activeStage.people.role} />
                                                    </div>
                                                </div>
                                                
                                                {/* The Coordinators - Inline Layout */}
                                                <div className="space-y-1.5">
                                                    <div className="text-[9px] font-bold text-slate-400 uppercase tracking-wider">The Coordinators</div>
                                                    <div className="text-sm font-medium text-slate-700 leading-relaxed">
                                                        <HighlightText text={activeStage.people.sub} />
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            {/* Front Process Section - Compact List Design */}
                                            <div className="space-y-3">
                                                <h3 className="text-[10px] font-bold text-slate-400 uppercase flex items-center gap-2">
                                                    <span className="w-2 h-2 rounded-full" style={{backgroundColor: activeStage.color}}></span> Our Processes ({activeStage.process.length})
                                                </h3>
                                                
                                                <div className="space-y-2">
                                                    {activeStage.process.map((p, i) => {
                                                        // Get background and border colors based on status
                                                        const statusStyles = {
                                                            'NEW': { bg: 'bg-indigo-50', border: 'border-l-indigo-400' },
                                                            'ACTIVE': { bg: 'bg-slate-50', border: 'border-l-slate-300' },
                                                            'TODO': { bg: 'bg-orange-50', border: 'border-l-orange-400' },
                                                            'MERGE': { bg: 'bg-red-50', border: 'border-l-red-400' }
                                                        };
                                                        const style = statusStyles[p.status] || statusStyles['ACTIVE'];
                                                        
                                                        return (
                                                            <div 
                                                                key={i} 
                                                                className={`${style.bg} ${style.border} border-l-2 pl-3 pr-3 py-2.5 rounded-r flex items-center justify-between group hover:shadow-sm transition-shadow`}
                                                            >
                                                                <div className="text-sm font-medium text-slate-700 flex-1">{p.name}</div>
                                                                <ProcessBadge status={p.status} color={activeStage.color} />
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        </div>

                                        {/* THE INTELLIGENCE LAYER (Accordion) */}
                                        <AIDataSection aiData={activeStage.aiData} stageColor={activeStage.color} />
                                    </motion.div>
                                </motion.div>
                            </AnimatePresence>
                        </div>
                    </div>

                    {/* LABEL: SUPPORT ENGINE (SOCLE) - Reversed Colors */}
                    <div className="flex items-center gap-3 md:gap-4 px-2 mb-4 mt-6">
                        <div className="text-xs md:text-sm font-bold text-white bg-[#0B0F19] border border-slate-700 px-4 py-2 rounded-md uppercase tracking-wider shadow-sm">The Support Engine (Socle)</div>
                        <div className="h-px bg-slate-700 flex-grow"></div>
                    </div>
                    
                    {/* SUPPORT ENGINE SECTION - Redesigned */}
                    <div className="px-4 md:px-6 mb-6">
                        {/* Header Section - Matching Stage Cards Design */}
                        <div className="mb-6">
                            <h2 className="text-3xl md:text-4xl lg:text-5xl font-bold text-slate-900 mb-2 leading-tight">INTERNAL SUPPORT</h2>
                            <p className="serif italic text-slate-500 text-base md:text-lg mb-3">"We enable excellence."</p>
                            
                            {/* Description with Colored Left Border - Matching Stage Card Style */}
                            <div className="pl-4 pr-3 py-2.5 bg-slate-50 rounded-r-lg border-l-2" style={{borderColor: '#0B0F19'}}>
                                <p className="text-sm text-slate-600 leading-relaxed">
                                    We are the engine of stability and growth. We drive Excellence and deliver the promise through Consistent processes and shared Accountability, ensuring the business scales without friction or unnecessary complexity
                                </p>
                            </div>
                        </div>

                        {/* Support Engine Footer - 6 Pillars in Connected Grid */}
                        <SupportEngineFooter 
                            activePillars={activeStage?.activePillars || []}
                            gatewayActions={activeStage?.gateway || {}}
                        />
                    </div>

                    {/* Video Card */}
                    <div className="mt-8 bg-white rounded-xl border border-slate-200 shadow-sm p-6 md:p-8">
                        <h3 className="text-lg font-bold text-slate-900 mb-4 serif">
                            The Flywheel Concept from GOOD TO GREAT - In Just 2 Minutes
                        </h3>
                        <div className="relative w-full" style={{ paddingBottom: '56.25%' }}>
                            <iframe
                                className="absolute top-0 left-0 w-full h-full rounded-lg"
                                src="https://www.youtube.com/embed/lUOe4GwPyFM"
                                title="The Flywheel Concept from GOOD TO GREAT - In Just 2 Minutes"
                                frameBorder="0"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                allowFullScreen
                            ></iframe>
                        </div>
                    </div>

                    {/* Second Video Card */}
                    <div className="mt-8 bg-white rounded-xl border border-slate-200 shadow-sm p-6 md:p-8">
                        <h3 className="text-lg font-bold text-slate-900 mb-4 serif">
                            The Flywheel Concept That Will Change Your Business - In Just 24 Minutes
                        </h3>
                        <div className="relative w-full" style={{ paddingBottom: '56.25%' }}>
                            <iframe
                                className="absolute top-0 left-0 w-full h-full rounded-lg"
                                src="https://www.youtube.com/embed/drjzFJ2ZQu8"
                                title="The Flywheel Concept That Will Change Your Business - In Just 24 Minutes"
                                frameBorder="0"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                allowFullScreen
                            ></iframe>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<App />);
    </script>
</body>
</html>

